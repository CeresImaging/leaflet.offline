!function e(t,i,o){function n(s,l){if(!i[s]){if(!t[s]){var a="function"==typeof require&&require;if(!l&&a)return a(s,!0);if(r)return r(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var c=i[s]={exports:{}};t[s][0].call(c.exports,function(e){var i=t[s][1][e];return n(i?i:e)},c,c.exports,e,t,i,o)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)n(o[s]);return n}({1:[function(e,t,o){var n=e("./localforage");L.Control.SaveTiles=L.Control.extend({options:{position:"topleft",saveText:"",rmText:"-",confirm:null},initialize:function(e,t){this._baseLayer=e,L.setOptions(this,t)},onAdd:function(e){var t=L.DomUtil.create("div","savetiles leaflet-bar"),i=this.options;return this._createButton(i.saveText,"Save tiles","savetiles",t,this._saveTiles),this._createButton(i.rmText,"Remove tiles","rmtiles",t,this._rmTiles),t},_createButton:function(e,t,i,o,n){var r=L.DomUtil.create("a",i,o);return r.innerHTML=e,r.href="#",r.title=t,L.DomEvent.on(r,"mousedown dblclick",L.DomEvent.stopPropagation).on(r,"click",L.DomEvent.stop).on(r,"click",n,this).on(r,"click",this._refocusOnMap,this),r},_saveTiles:function(){var e;this._zoomsforSave||(this._zoomsforSave=[],this._tilesforSave=[]);var t=this._baseLayer._getTileSize();if(this.options.zoomlevels){e=this.options.zoomlevels[this._zoomsforSave.length];var o=this._map.getBounds(),n=L.bounds(this._map.project(o.getNorthWest(),e),this._map.project(o.getSouthEast(),e))}else var n=this._map.getPixelBounds(),e=this._map.getZoom();var r=L.bounds(n.min.divideBy(t).floor(),n.max.divideBy(t).floor());for(this._zoomsforSave.push(e),j=r.min.y;j<=r.max.y;j++)for(i=r.min.x;i<=r.max.x;i++){var s=new L.Point(i,j);s.z=e,this._tilesforSave.push(L.TileLayer.prototype.getTileUrl.call(this._baseLayer,s))}if(this.options.zoomlevels&&this._zoomsforSave.length<this.options.zoomlevels.length)return void this._saveTiles();delete this._zoomsforSave;var l=this;if(this.options.confirm){var a=$.Deferred();this.options.confirm.call(this,a),a.done(function(){l._baseLayer.fire("savestart",l),l._loadTile(l._tilesforSave.shift())})}else l._baseLayer.fire("savestart",l),l._loadTile(l._tilesforSave.shift())},_loadTile:function(e){var t=this,i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.send();var t=this;i.onreadystatechange=function(){4===this.readyState&&200===this.status&&(t._saveTile(e,this.response),t._tilesforSave.length>0?(t._loadTile(t._tilesforSave.shift()),t._baseLayer.fire("loadtileend")):(t._baseLayer.fire("loadtileend"),t._baseLayer.fire("loadend")))}},_saveTile:function(e,t){n.removeItem(e).then(function(){n.setItem(e,t).then(function(){console.log(1)}).catch(function(e){console.error(e)})}).catch(function(e){console.error(e)})},onRemove:function(){},_rmTiles:function(){$this=this,n.clear().then(function(){$this._baseLayer.fire("tilesremoved")})}}),L.control.savetiles=function(e,t){return new L.Control.SaveTiles(e,t)}},{"./localforage":4}],2:[function(e,t,i){var o=e("./localforage");L.TileLayer.Offline=L.TileLayer.Functional.extend({initialize:function(e,t){var i=function(e,t){var i=$.Deferred(),n=e.replace("{z}",t.zoom).replace("{y}",t.tile.row).replace("{x}",t.tile.column).replace("{s}",t.subdomain);return o.getItem(n).then(function(e){e&&"object"==typeof e&&(n=URL.createObjectURL(e)),i.resolve(n)}),i.promise()};this._tileFunction=i,L.TileLayer.prototype.initialize.call(this,e,t)},getTileUrl:function(e){var t=this._map,i=t.options.crs,o=this.options.tileSize,n=e.z,r=e.multiplyBy(o),s=r.add(new L.Point(o,o)),l=i.project(t.unproject(r,n)),a=i.project(t.unproject(s,n)),f=[l.x,a.y,a.x,l.y].join(","),c={bbox:f,width:o,height:o,zoom:n,tile:{row:this.options.tms?this._tileNumBounds.max.y-e.y:e.y,column:e.x},subdomain:this._getSubdomain(e)};return this._tileFunction(this._url,c)}}),L.tileLayer.offline=function(e,t){return new L.TileLayer.Offline(e,t)}},{"./localforage":4}],3:[function(e,t,i){e("./Control.SaveTiles"),e("./TileLayer.Offline")},{"./Control.SaveTiles":1,"./TileLayer.Offline":2}],4:[function(e,t,i){(function(e){var i="undefined"!=typeof window?window.localforage:"undefined"!=typeof e?e.localforage:null;i.config({name:"leaflet_offline",version:1,size:4980736,storeName:"tiles",description:"the tiles"}),t.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[3]);