!function e(t,i,o){function n(r,a){if(!i[r]){if(!t[r]){var l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(s)return s(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var f=i[r]={exports:{}};t[r][0].call(f.exports,function(e){var i=t[r][1][e];return n(i?i:e)},f,f.exports,e,t,i,o)}return i[r].exports}for(var s="function"==typeof require&&require,r=0;r<o.length;r++)n(o[r]);return n}({1:[function(e,t,i){var o=e("./localforage");L.Control.SaveTiles=L.Control.extend({options:{position:"topleft",saveText:"+",rmText:"-",maxZoom:19,saveWhatYouSee:!1,confirm:null,confirmRemoval:null},status:{storagesize:null,lengthToBeSaved:null,lengthSaved:null,lengthLoaded:null,_tilesforSave:null},initialize:function(e,t){this._baseLayer=e,this.setStorageSize(),L.setOptions(this,t)},setStorageSize:function(e){var t=this;return this.status.storagesize?void e(this.status.storagesize):void o.length().then(function(i){t.status.storagesize=i,t._baseLayer.fire("storagesize",t.status),e&&e(i)}).catch(function(t){throw e(0),t})},getStorageSize:function(e){this.setStorageSize(e)},setLayer:function(e){this._baseLayer=e},onAdd:function(){var e=L.DomUtil.create("div","savetiles leaflet-bar"),t=this.options;return this._createButton(t.saveText,"Save tiles","savetiles",e,this._saveTiles),this._createButton(t.rmText,"Remove tiles","rmtiles",e,this._rmTiles),e},_createButton:function(e,t,i,o,n){var s=L.DomUtil.create("a",i,o);return s.innerHTML=e,s.href="#",s.title=t,L.DomEvent.on(s,"mousedown dblclick",L.DomEvent.stopPropagation).on(s,"click",L.DomEvent.stop).on(s,"click",n,this).on(s,"click",this._refocusOnMap,this),s},_saveTiles:function(){var e,t=this,i=[],o=5,n=[];if(this.options.saveWhatYouSee){var s=this._map.getZoom();if(s<o)throw new Error("It's not possible to save with zoom below level 5.");for(var r=this.options.maxZoom,a=s;a<=r;a++)n.push(a)}else n=this.options.zoomlevels||[this._map.getZoom()];var l=this._map.getBounds();for(var u in n)e=L.bounds(this._map.project(l.getNorthWest(),n[u]),this._map.project(l.getSouthEast(),n[u])),i=i.concat(this._baseLayer.getTileUrls(e,n[u]));this._resetStatus(i);var f=function(){t._baseLayer.fire("savestart",t.status);for(var e=t._baseLayer.getSimultaneous(),i=0;i<e;i++)t._loadTile()};this.options.confirm?this.options.confirm(this.status,f):f()},_resetStatus:function(e){this.status={lengthLoaded:0,lengthToBeSaved:e.length,lengthSaved:0,_tilesforSave:e}},_loadTile:function(){var e=this,t=e.status._tilesforSave.shift(),i=new XMLHttpRequest;i.open("GET",t.url),i.responseType="blob",i.send(),i.onreadystatechange=function(){4===this.readyState&&200===this.status&&(e.status.lengthLoaded++,e._saveTile(t.key,this.response),e.status._tilesforSave.length>0?(e._loadTile(),e._baseLayer.fire("loadtileend",e.status)):(e._baseLayer.fire("loadtileend",e.status),e.status.lengthLoaded===e.status.lengthToBeSaved&&e._baseLayer.fire("loadend",e.status)))}},_saveTile:function(e,t){var i=this;o.removeItem(e).then(function(){o.setItem(e,t).then(function(){i.status.lengthSaved++,i._baseLayer.fire("savetileend",i.status),i.status.lengthSaved===i.status.lengthToBeSaved&&(i._baseLayer.fire("saveend",i.status),i.setStorageSize())}).catch(function(e){throw new Error(e)})}).catch(function(e){throw new Error(e)})},_rmTiles:function(){var e=this,t=function(){o.clear().then(function(){e.status.storagesize=0,e._baseLayer.fire("tilesremoved"),e._baseLayer.fire("storagesize",e.status)})};this.options.confirmRemoval?this.options.confirmRemoval(this.status,t):t()}}),L.control.savetiles=function(e,t){return new L.Control.SaveTiles(e,t)}},{"./localforage":4}],2:[function(e,t,i){var o=e("./localforage");L.TileLayer.Offline=L.TileLayer.extend({diffZoom:1,createTile:function(e,t){var i=document.createElement("img");return L.DomEvent.on(i,"load",L.bind(this._tileOnLoad,this,t,i)),L.DomEvent.on(i,"error",L.bind(this._tileOnError,this,t,i)),this.options.crossOrigin&&(i.crossOrigin=""),i.alt="",i.setAttribute("role","presentation"),this.getTileUrl(e).then(function(e){i.src=e}).catch(function(e){throw new Error(e)}),i},getTileUrl:function(e){var t=this,i=new Promise(function(i,n){var s=L.TileLayer.prototype.getTileUrl.call(t,e);o.getItem(t._getStorageKey(s)).then(function(e){e&&"object"==typeof e&&i(URL.createObjectURL(e)),i(s)}).catch(function(e){n(e)})});return i},_getStorageKey:function(e){var t;if(e.indexOf("{s}")){var i=new RegExp("["+this.options.subdomains.join("|")+"].");t=e.replace(i,this.options.subdomains[0]+".")}return t||e},getSimultaneous:function(){return this.options.subdomains.length},getTileUrls:function(e,t){var i=[],o=this._url;this.setUrl(this._url.replace("{z}",t),!0);for(var n,s=L.bounds(e.min.divideBy(this.getTileSize().x).floor(),e.max.divideBy(this.getTileSize().x).floor()),r=s.min.y;r<=s.max.y;r++)for(var a=s.min.x;a<=s.max.x;a++){var l=new L.Point(a,r);n=L.TileLayer.prototype.getTileUrl.call(this,l),i.push({key:this._getStorageKey(n),url:n})}return this.setUrl(o,!0),i}}),L.tileLayer.offline=function(e,t){return new L.TileLayer.Offline(e,t)}},{"./localforage":4}],3:[function(e,t,i){e("./Control.SaveTiles"),e("./TileLayer.Offline")},{"./Control.SaveTiles":1,"./TileLayer.Offline":2}],4:[function(e,t,i){(function(e){var i="undefined"!=typeof window?window.localforage:"undefined"!=typeof e?e.localforage:null;i.config({name:"leaflet_offline",version:1,size:4980736,storeName:"tiles",description:"the tiles"}),t.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[3]);