!function e(t,o,i){function n(s,a){if(!o[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var c=o[s]={exports:{}};t[s][0].call(c.exports,function(e){var o=t[s][1][e];return n(o?o:e)},c,c.exports,e,t,o,i)}return o[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}({1:[function(e,t,o){var i=e("./localforage");L.Control.SaveTiles=L.Control.extend({options:{position:"topleft",saveText:"",rmText:"-",confirm:null},initialize:function(e,t){this._baseLayer=e,L.setOptions(this,t)},onAdd:function(){var e=L.DomUtil.create("div","savetiles leaflet-bar"),t=this.options;return this._createButton(t.saveText,"Save tiles","savetiles",e,this._saveTiles),this._createButton(t.rmText,"Remove tiles","rmtiles",e,this._rmTiles),e},_createButton:function(e,t,o,i,n){var r=L.DomUtil.create("a",o,i);return r.innerHTML=e,r.href="#",r.title=t,L.DomEvent.on(r,"mousedown dblclick",L.DomEvent.stopPropagation).on(r,"click",L.DomEvent.stop).on(r,"click",n,this).on(r,"click",this._refocusOnMap,this),r},_saveTiles:function(){this._zoomsforSave||(this._zoomsforSave=[],this._tilesforSave=[]);var e,t,o=this._baseLayer.getTileSize().x;if(this.options.zoomlevels){t=this.options.zoomlevels[this._zoomsforSave.length];var i=this._map.getBounds();e=L.bounds(this._map.project(i.getNorthWest(),t),this._map.project(i.getSouthEast(),t))}else e=this._map.getPixelBounds(),t=this._map.getZoom();var n=L.bounds(e.min.divideBy(o).floor(),e.max.divideBy(o).floor());this._zoomsforSave.push(t);for(var r=n.min.y;r<=n.max.y;r++)for(var s=n.min.x;s<=n.max.x;s++){var a=new L.Point(s,r);a.z=t,this._tilesforSave.push(L.TileLayer.prototype.getTileUrl.call(this._baseLayer,a))}if(this.options.zoomlevels&&this._zoomsforSave.length<this.options.zoomlevels.length)return void this._saveTiles();delete this._zoomsforSave;var l=this;if(this.options.confirm){var f=$.Deferred();this.options.confirm.call(this,f),f.done(function(){l._baseLayer.fire("savestart",l),l._loadTile(l._tilesforSave.shift())})}else l._baseLayer.fire("savestart",l),l._loadTile(l._tilesforSave.shift())},_loadTile:function(e){var t=this,o=new XMLHttpRequest;o.open("GET",e),o.responseType="blob",o.send(),o.onreadystatechange=function(){4===this.readyState&&200===this.status&&(t._saveTile(e,this.response),t._tilesforSave.length>0?(t._loadTile(t._tilesforSave.shift()),t._baseLayer.fire("loadtileend")):(t._baseLayer.fire("loadtileend"),t._baseLayer.fire("loadend")))}},_saveTile:function(e,t){i.removeItem(e).then(function(){i.setItem(e,t).then(function(){}).catch(function(e){console.error(e)})}).catch(function(e){console.error(e)})},onRemove:function(){},_rmTiles:function(){var e=this;i.clear().then(function(){e._baseLayer.fire("tilesremoved")})}}),L.control.savetiles=function(e,t){return new L.Control.SaveTiles(e,t)}},{"./localforage":4}],2:[function(e,t,o){var i=e("./localforage");L.TileLayer.Offline=L.TileLayer.extend({createTile:function(e,t){var o=document.createElement("img");return L.DomEvent.on(o,"load",L.bind(this._tileOnLoad,this,t,o)),L.DomEvent.on(o,"error",L.bind(this._tileOnError,this,t,o)),this.options.crossOrigin&&(o.crossOrigin=""),o.alt="",o.setAttribute("role","presentation"),this.getTileUrl(e).then(function(e){o.src=e}).catch(function(e){throw new Error(e)}),o},getTileUrl:function(e){var t=this,o=new Promise(function(o,n){var r=L.TileLayer.prototype.getTileUrl.call(t,e);i.getItem(r).then(function(e){e&&"object"==typeof e&&o(URL.createObjectURL(e)),o(r)}).catch(function(e){n(e)})});return o}}),L.tileLayer.offline=function(e,t){return new L.TileLayer.Offline(e,t)}},{"./localforage":4}],3:[function(e,t,o){e("./Control.SaveTiles"),e("./TileLayer.Offline")},{"./Control.SaveTiles":1,"./TileLayer.Offline":2}],4:[function(e,t,o){(function(e){var o="undefined"!=typeof window?window.localforage:"undefined"!=typeof e?e.localforage:null;o.config({name:"leaflet_offline",version:1,size:4980736,storeName:"tiles",description:"the tiles"}),t.exports=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[3]);